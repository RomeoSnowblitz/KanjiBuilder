#!/usr/bin/env node
/**
 * Build script: reads all PNGs from placeholders/ and writes images-data.js
 * with base64 data URLs so images work when the app is opened via file:// (no server).
 * Run once: node build-embed-images.js
 * Then commit images-data.js so users who open from zip get images.
 */

const fs = require("fs");
const path = require("path");

const PLACEHOLDERS_DIR = path.join(__dirname, "placeholders");
const OUT_FILE = path.join(__dirname, "images-data.js");

if (!fs.existsSync(PLACEHOLDERS_DIR)) {
  console.error("placeholders/ folder not found. Run this from the project root.");
  process.exit(1);
}

const files = fs.readdirSync(PLACEHOLDERS_DIR).filter((f) => f.endsWith(".png"));
const entries = [];

for (const file of files) {
  const key = "placeholders/" + file;
  const filePath = path.join(PLACEHOLDERS_DIR, file);
  const buf = fs.readFileSync(filePath);
  const base64 = buf.toString("base64");
  const dataUrl = "data:image/png;base64," + base64;
  entries.push({ key, dataUrl });
}

const lines = [
  "// Auto-generated by build-embed-images.js â€” do not edit by hand",
  "// Embeds placeholder images as data URLs so they load on file:// (no server needed)",
  "window.IMAGE_DATA = window.IMAGE_DATA || {};",
  ...entries.map((e) => "window.IMAGE_DATA[" + JSON.stringify(e.key) + "] = " + JSON.stringify(e.dataUrl) + ";"),
];

fs.writeFileSync(OUT_FILE, lines.join("\n"), "utf8");
console.log("Wrote " + OUT_FILE + " (" + entries.length + " images).");
